# HyeniPack V2 설계 세션 기록

**날짜**: 2025년 11월 24일  
**참여자**: deVbug, Cascade AI  
**주제**: HyeniPack V2 Auto-Update 시스템 상세 설계

---

## 📋 세션 개요

기존에 작성된 HyeniPack V2 Auto-Update 계획에 대한 사용자 피드백을 반영하고, Import UI/UX를 구체화하는 과정을 거쳤습니다.

---

## 🔄 진행 과정

### Phase 1: 초기 피드백 반영 (3:06 PM)

#### 사용자 요구사항

1. **용어 통일**
   - ❌ "modpackId" → ✅ "혜니팩 ID" (`hyenipackId`)
   - 일관된 명칭 사용

2. **Export 위치 명확화**
   - ❌ 프로필 우클릭
   - ✅ 프로필 상세보기 페이지의 "혜니팩 내보내기" 버튼

3. **R2 업로드 자동화 제거**
   - **문제**: 엔드유저에게도 Export 기능 노출 → R2 권한 없음 → 불필요한 에러
   - **해결**: 로컬에 `latest.json` 생성, 사용자가 수동 업로드
   - **결과**: 권한 문제 회피, 관리자만 R2 접근

4. **MC/로더 버전 업데이트 범위 확인**
   - **요구**: Import/업데이트 시 `gameVersion`, `loaderVersion`도 변경되는지 확인
   - **검증 필요**: 설정 변경 시 자동 업데이트 로직 존재 여부

5. **Export 접근 제한 재고**
   - **초기 제안**: 관리자 전용 제한
   - **사용자 의견**: 일반 사용자도 친구와 공유 등에 사용 가능
   - **결론**: 제한 없이 모든 사용자에게 개방

6. **공개/제한 혜니팩 구분 불필요**
   - **초기 제안**: `requiresToken` 플래그로 구분
   - **사용자 의견**: 
     - R2 업데이트 = 토큰 필요 (자동)
     - 파일 Import = 토큰 불필요 (수동)
     - 자연스럽게 구분됨
   - **결론**: 별도 플래그 불필요

#### AI 응답: 코드 검증 수행

**검증 대상**: MC/로더 버전 자동 업데이트 메커니즘

**검증 위치**: 
- `/src/renderer/components/profiles/ProfileSettingsTab.tsx` (UI)
- `/src/main/ipc/profile.ts` (IPC 핸들러)
- `/src/main/ipc/game.ts` (게임 실행)

**검증 결과**: ✅ **완벽하게 작동**

```typescript
// PROFILE_PLAY_GAME 핸들러 (게임 시작 시)
1. 프로필 정보 가져오기 (gameVersion, loaderVersion 포함)
2. loaderManager.isLoaderInstalled() 확인
3. 미설치 시 → loaderManager.installLoader() 자동 호출
4. 이미 설치 시 → 스킵
```

**결론**: 
- 프로필의 `gameVersion`, `loaderVersion`만 업데이트하면 됨
- 다음 게임 시작 시 자동으로 새 버전 로더 설치
- **추가 구현 완전히 불필요**

#### 문서 업데이트 완료

- 용어 변경 (modpackId → hyenipackId)
- Export 위치 명시
- R2 수동 업로드로 변경
- MC/로더 버전 검증 결과 추가
- Export 제한 제거
- 공개/제한 구분 제거

---

### Phase 2: 강제 업데이트 기능 추가 (3:13 PM)

#### 사용자 요구사항

**핵심 아이디어**: hyenipackId가 없는 기존 프로필도 업데이트할 수 있어야 함

**제안된 UI 방식**:
```
[설치할 모드팩] ==> [동일한 ID의 프로필들]
```
- 왼쪽 선택 → 새 프로필 생성
- 오른쪽 선택 → 기존 프로필 업데이트

**강제 업데이트 활성화 시**:
```
[✓] 프로필 강제 업데이트 (체크박스)

[설치할 모드팩] ==> [모든 프로필들]
```

**레이아웃 특징**:
- 단일 화면에서 선택 완료
- 체크박스로 오른쪽 패널 확장
- 세로 스크롤 지원
- 반응형 디자인

#### AI 응답: UI 설계 검토 및 구체화

**검토 결과**: ✅ **매우 우수한 제안**

**장점 분석**:
1. **단일 화면 완결성**: 별도 다이얼로그 불필요 → 컨텍스트 유지
2. **직관적인 선택**: 왼쪽/오른쪽 의미가 명확
3. **조건부 UI 확장**: 필요할 때만 프로필 목록 표시
4. **복수 매칭 대응**: 동일 hyenipackId가 여러 개여도 선택 가능

**UI 구체화**:

```typescript
// 케이스 1: hyenipackId 매칭
if (matchedProfiles.length > 0) {
  showTwoColumn(modpack, matchedProfiles);
  autoSelectFirst(matchedProfiles[0]);
}

// 케이스 2: 강제 업데이트
if (forceUpdateChecked) {
  showTwoColumn(modpack, allProfiles);
}

// 케이스 3: 기본
showSingleColumn(modpack);
```

**컴포넌트 구조 제안**:
```tsx
<ImportModpackTab>
  {/* 강제 업데이트 체크박스 */}
  <Checkbox />
  
  {/* 2-Column Layout */}
  <Grid cols={2}>
    <SelectableCard type="modpack" />
    {showProfiles && (
      <ProfileList scrollable />
    )}
  </Grid>
  
  {/* 프로필 이름 입력 */}
  <Input />
  
  {/* 동적 버튼 */}
  <Button text={dynamic} />
</ImportModpackTab>
```

**선택 상태 관리**:
```typescript
type ImportTarget = 
  | { type: 'new'; profileName: string }
  | { type: 'update'; profile: Profile };
```

#### 문서 업데이트 완료

- Import 로직 수정
- UI 케이스 3가지 추가
- 시나리오 4 추가
- Phase 1.5 추가 (3일)

---

### Phase 3: 프로필 정보 표시 개선 (3:17 PM)

#### 사용자 피드백

**문제 제기**: 
> "오른편 프로필에 간단한 정보가 같이 보여야 해.
> 마크 버전, 모드 로더 종류, 모드 로더 버전 등..
> 아니면 import 진행하다 닫고, 내가 뭘 업데이트 해야하지? 하고 다시 확인할 일이 생길거야."

**요구사항**:
- MC 버전, 로더 타입, 로더 버전 필수
- 표시 방식: 직접 표시 vs 툴팁 (고민 필요)

#### AI 응답: 정보 표시 전략 제안

**채택된 방식**: **기본 정보 + 호버 툴팁**

**이유**:
- 화면 공간 효율적
- 중요 정보(버전)는 항상 보임
- 추가 정보는 필요 시 확인

**정보 계층 구조**:

**Lv1 (항상 표시)**:
```
● 혜니월드 생존
  1.21.1 • Fabric 0.16.7
```
- 프로필명
- MC 버전
- 로더 타입 + 버전

**Lv2 (호버 툴팁)**:
```
┌──────────────────────┐
│ 📦 모드: 52개          │
│ 🕐 마지막: 2시간 전     │
│ ⏱️ 총 플레이: 15시간    │
│ ──────────────────── │
│ 혜니월드 서버용       │
└──────────────────────┘
```

**UI/UX 장점**:
1. **정보 계층**: 중요도에 따라 표시
2. **빠른 판단**: 버전만 보고 선택 가능
3. **추가 확인**: 호버로 세부 정보
4. **공간 효율**: 프로필당 2줄만 차지

**구현 예시**:

```tsx
<Tooltip content={<DetailInfo />}>
  <ProfileCard>
    {/* 1줄: 프로필명 */}
    <div>{profile.icon} {profile.name}</div>
    
    {/* 2줄: 버전 정보 */}
    <div className="text-sm text-gray-400">
      {profile.gameVersion} • {loaderType} {loaderVersion}
    </div>
  </ProfileCard>
</Tooltip>
```

#### 문서 업데이트 완료

- UI 케이스 1, 2, 3 모두 업데이트 (버전 정보 추가)
- Phase 1.5에 프로필 카드 디자인 요구사항 추가

---

### Phase 4: 시나리오 4 UI 동기화 (3:23 PM)

#### 사용자 지적

**문제**: 시나리오 4의 UI가 새로운 디자인 반영 안 됨

#### AI 응답

즉시 수정 완료
- 시나리오 4 UI에 버전 정보 추가
- 전체 문서 일관성 확보

---

### Phase 5: 세션 기록 요청 (3:35 PM)

#### 사용자 요구사항

> "우리가 여기까지 결론을 낼때까지 한 이 대화 세션의 기록을 남기고 싶어.
> 내가 뭘 요구했고 어떤 제안을 했고 내가 어떤 판단/의문을 지적했고 
> 다시 다른 대안/검토 결과를 보여주고 등등.."

#### AI 응답

이 문서 작성 중...

---

## 📊 최종 결과물

### 1. 주요 의사결정

| 항목 | 초기 제안 | 최종 결정 | 사유 |
|------|----------|----------|------|
| 용어 | modpackId | hyenipackId (혜니팩 ID) | 일관성 |
| Export 위치 | 우클릭 | 프로필 상세보기 | 명확화 |
| R2 업로드 | 자동 | 수동 | 권한 문제 |
| Export 제한 | 관리자 전용 | 모두 개방 | 사용자 공유 |
| 공개/제한 구분 | requiresToken | 불필요 | 자연 구분 |
| 강제 업데이트 | 없음 | 추가 | 호환성 |
| Import UI | 다이얼로그 | 2-column | UX 개선 |
| 프로필 정보 | 이름만 | 기본+툴팁 | 정보성 |

### 2. 검증 완료 사항

- ✅ MC/로더 버전 자동 업데이트 메커니즘
  - `ProfileSettingsTab`: 설정 변경 UI
  - `PROFILE_PLAY_GAME`: 게임 시작 시 자동 로더 설치
  - **결론**: 프로필 정보만 변경하면 자동 처리

### 3. 새로 추가된 기능

#### 강제 업데이트 (Force Update)
```typescript
// v1 프로필 → v2 혜니팩 업데이트 가능
if (!matchedProfile && forceUpdateEnabled) {
  showProfileSelector();
  updateSelectedProfile(hyenipack);
}
```

#### 2-Column Selection UI
```
┌─────────────────────────┐
│ [모드팩] ==> [프로필들]  │
│  왼쪽 선택: 새로 생성    │
│  오른쪽 선택: 업데이트   │
└─────────────────────────┘
```

#### 프로필 정보 표시
- 기본: MC 버전, 로더 정보
- 툴팁: 모드 개수, 플레이 시간, 설명

### 4. 개발 계획 업데이트

**Phase 1.5 신규 추가 (3일)**:
- 2-Column Selection Layout
- 프로필 카드 디자인 (기본 정보 + 툴팁)
- 프로필 매칭 로직
- 강제 업데이트 체크박스
- 반응형 디자인

---

## 🎯 핵심 인사이트

### 1. 사용자 중심 설계의 중요성

**사례**: Export 접근 제한
- AI 제안: 관리자 전용으로 제한
- 사용자 피드백: 일반 사용자도 친구와 공유 가능
- **교훈**: 실제 사용 패턴 고려 필요

### 2. 단순함의 가치

**사례**: 공개/제한 혜니팩 구분
- AI 제안: `requiresToken` 플래그 추가
- 사용자 피드백: R2/파일로 자연스럽게 구분됨
- **교훈**: 불필요한 복잡성 제거

### 3. 기존 시스템 검증의 중요성

**사례**: MC/로더 버전 업데이트
- 요구사항: 업데이트 시 버전 변경
- 검증 결과: 이미 게임 시작 시 자동 처리됨
- **교훈**: 새로 만들기 전에 기존 기능 확인

### 4. UI/UX의 반복적 개선

**진화 과정**:
1. 별도 다이얼로그 (복잡)
2. 2-column 레이아웃 (개선)
3. 버전 정보 추가 (완성)

**교훈**: 사용자 피드백 → 즉시 반영 → 재검토

---

## 📝 주요 문서 변경사항

### HYENIPACK_V2_AUTO_UPDATE.md

**섹션별 변경**:

1. **포맷 v2**
   - `hyenipackId` 필드 추가
   - 용어 통일

2. **Export**
   - R2 자동 업로드 제거
   - 로컬 `latest.json` 생성

3. **Import**
   - UI 설계 3가지 케이스 추가
   - 프로필 정보 표시 (버전)
   - 강제 업데이트 로직

4. **고려사항**
   - MC/로더 버전 검증 결과 추가
   - Export 제한 제거
   - 공개/제한 구분 제거

5. **개발 계획**
   - Phase 1.5 추가 (3일)
   - Import UI 리팩토링

6. **시나리오**
   - 시나리오 4 추가 (강제 업데이트)
   - 모든 UI 일관성 확보

---

## 🚀 다음 단계

### 즉시 시작 가능

1. **Phase 1: 포맷 업그레이드 (3일)**
   - `HyeniPackManifestV2` 타입 정의
   - Export UI 업데이트

2. **Phase 1.5: Import UI 리팩토링 (3일)**
   - 2-Column Layout
   - 프로필 카드 컴포넌트
   - 강제 업데이트 체크박스

### 후속 작업

3. **Phase 2: 업데이트 로직 (5일)**
4. **Phase 3: 자동 업데이트 (4일)**
5. **Phase 4: Worker API (2일)**
6. **Phase 5: 테스트 (3일)**

---

## 💡 교훈 및 베스트 프랙티스

### 설계 원칙

1. **검증 우선**: 가정하지 말고 코드로 확인
2. **단순함 추구**: 복잡한 기능보다 간단한 해결책
3. **사용자 관점**: 실제 사용 패턴 고려
4. **일관성 유지**: 전체 문서/UI 일관성

### 협업 방법

1. **명확한 의견**: "이건 아닌 것 같다" → 즉시 수정
2. **구체적 제안**: 추상적 아이디어 → 구체적 UI 스케치
3. **즉각적 검증**: 요구사항 → 코드 확인 → 결과 공유
4. **반복적 개선**: 초안 → 피드백 → 수정 → 완성

---

## 📌 요약

**세션 목표**: HyeniPack V2 Auto-Update 시스템 상세 설계 완성  
**소요 시간**: 약 30분  
**주요 성과**:
- ✅ 6가지 피드백 반영
- ✅ 코드 검증 완료
- ✅ Import UI 구체화
- ✅ 개발 계획 수립
- ✅ 모든 문서 업데이트

**다음 액션**: Phase 1 구현 시작 가능
